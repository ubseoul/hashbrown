<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Chess Tactics Dojo ‚Äî Self‚ÄëContained</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  :root{--bg:#141833;--panel:#171a2a;--ink:#e7e9ff;--accent:#7bdcff;--good:#4ade80;--bad:#f87171;--warn:#fbbf24;--sq-light:#f4ecd0;--sq-dark:#b58863;--sq-contrast-light:#fff6bf;--sq-contrast-dark:#5a6b9a}
  *{box-sizing:border-box}
  body { background: var(--bg); color: var(--ink); font-family: system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial; margin: 0; padding: 0; display: grid; place-items: start center; gap: 1rem; }
  header{width:100%; padding: .75rem 1rem; background:#0f142c; border-bottom:1px solid #222a4d; position:sticky; top:0}
  h1 { margin: 0; font-size: 1.1rem }
  .app{width: min(980px, 96vw); display: grid; grid-template-columns: 1fr 320px; gap: 1rem; padding: .75rem}
  @media (max-width: 860px){ .app{ grid-template-columns: 1fr } }
  .card{background: var(--panel); border:1px solid #242947; border-radius: 14px; padding: .75rem}
  #board { width: 100%; max-width: 620px; margin:auto }

  /* BOARD */
  .boardWrap{position:relative}
  .boardGrid{ width:100%; aspect-ratio:1/1; border-collapse: collapse; table-layout: fixed; border:8px solid #0f142c; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,.35) }
  .boardGrid td{ width:12.5%; height:12.5%; padding:0; text-align:center; vertical-align:middle; user-select:none; cursor:pointer; position:relative }
  .light{ background: var(--sq-light) } .dark{ background: var(--sq-dark) }
  .hc .light{ background: var(--sq-contrast-light) } .hc .dark{ background: var(--sq-contrast-dark) }
  .sel{ outline: 4px solid #ffd200; outline-offset:-4px }
  .hintSq{ box-shadow: inset 0 0 0 4px rgba(251,191,36,.9) }
  .coord-file{ position:absolute; bottom:4px; right:6px; font-size:11px; opacity:.6; font-weight:600 }
  .coord-rank{ position:absolute; top:4px; left:6px; font-size:11px; opacity:.6; font-weight:600 }

  /* PIECES */
  .piece{ font-weight: 900; font-size: clamp(34px, 8.5vw, 66px); line-height:1; text-rendering: geometricPrecision; -webkit-font-smoothing: antialiased; display:inline-block; filter: drop-shadow(0 1px 0 rgba(0,0,0,.25)); }
  .piece.white{ color:#ffffff; text-shadow: 0 0 2px rgba(0,0,0,.6), 0 1px 0 rgba(0,0,0,.8) }
  .piece.black{ color:#101015; text-shadow: 0 0 2px rgba(255,255,255,.7), 0 1px 0 rgba(255,255,255,.9) }
  .alpha .piece.white{ color:#ffffff }
  .alpha .piece.black{ color:#101015 }

  .controls{ display:flex; flex-wrap:wrap; gap:.5rem; justify-content:center; margin-top:.6rem }
  button{ background:#2a3162; color:#fff; border:1px solid #3a4280; padding:.55rem .85rem; border-radius:10px; cursor:pointer }
  select{ background:#121736; color:#fff; border:1px solid #2b3154; border-radius:10px; padding:.45rem .6rem }
  .pill{ display:inline-flex; align-items:center; gap:.35rem; border:1px solid #2b3154; background:#161a31; padding:.25rem .5rem; border-radius:999px; font-size:.85rem }
  .good{ color: var(--good) } .bad{ color: var(--bad) } .warn{ color: var(--warn) }
  .banner{ background:#121736; border:1px solid #2a3162; border-radius:12px; padding:.5rem .75rem; margin-top:.5rem }
</style>
</head>
<body>
<header><h1>‚ôüÔ∏è Chess Tactics Dojo ‚Äî Beginner ‚ûú Advanced</h1></header>
<div class="app">
  <section class="card">
    <div id="board" class="boardWrap"></div>
    <div class="controls">
      <button id="btnHint">üí° Hint</button>
      <button id="btnSolution">‚úÖ Solution</button>
      <button id="btnRetry">‚Üª Retry</button>
      <button id="btnNext">Next ‚ûú</button>
      <select id="selTheme">
        <option value="classic" selected>Board: Classic</option>
        <option value="high">Board: High Contrast</option>
      </select>
      <select id="selPieces">
        <option value="symbols" selected>Pieces: Symbols</option>
        <option value="alpha">Pieces: Letters</option>
      </select>
      <span class="pill" id="turnBadge">White to move</span>
      <span class="pill" id="status">Status: Ready</span>
    </div>
    <div class="banner" id="pzlInfo">Puzzle: ‚Äì</div>
  </section>
  <aside class="card">
    <h3 style="margin-top:.25rem">Curriculum</h3>
    <ul style="margin:.4rem 0 0 1rem; padding:0; line-height:1.4">
      <li>Mates (1‚Äì3)</li>
      <li>Forks & Pins</li>
      <li>Skewers, Discovered</li>
      <li>Clearance, Deflection/Decoy</li>
      <li>Overloading, Zwischenzug</li>
      <li>Trapped Piece, X‚Äëray</li>
    </ul>
    <p style="opacity:.8">All puzzles are built‚Äëin. No internet required. Upload this single file to GitHub Pages.</p>
  </aside>
</div>
<script>
/********************
 * Clearer visuals  *
 ********************/
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));

// Configurable piece rendering: symbols (Unicode) or alpha (letters)
const USE = { mode:'symbols' }; // 'symbols' | 'alpha'
const SYMBOL = { 'P':'‚ôô','N':'‚ôò','B':'‚ôó','R':'‚ôñ','Q':'‚ôï','K':'‚ôî', 'p':'‚ôü','n':'‚ôû','b':'‚ôù','r':'‚ôú','q':'‚ôõ','k':'‚ôö' };
const ALPHA  = { 'P':'P','N':'N','B':'B','R':'R','Q':'Q','K':'K', 'p':'p','n':'n','b':'b','r':'r','q':'q','k':'k' };

function parseFEN(fen){
  const [placement, turn] = fen.split(' ');
  const rows = placement.split('/');
  const board = [];
  for(let r=0;r<8;r++){
    const row = []; const s = rows[r];
    for(const ch of s){ if(/[1-8]/.test(ch)){ for(let i=0;i<Number(ch);i++) row.push(''); } else { row.push(ch); } }
    board.push(row);
  }
  return { board, turn };
}

let state = { board:[], turn:'w' };
let selected = null; // e.g., 'e2'

function render(containerId){
  const container = document.getElementById(containerId);
  container.innerHTML='';
  const table = document.createElement('table');
  table.className = 'boardGrid';
  if(document.body.classList.contains('hc')) table.classList.add('hc');
  const files=['a','b','c','d','e','f','g','h'];
  for(let r=0;r<8;r++){
    const tr = document.createElement('tr');
    for(let c=0;c<8;c++){
      const td = document.createElement('td');
      const dark = (r+c)%2===1; td.className = dark? 'dark':'light';
      const piece = state.board[r][c];
      if(piece){
        const span = document.createElement('span');
        span.className = 'piece '+(piece===piece.toUpperCase()?'white':'black');
        span.textContent = (USE.mode==='alpha'? ALPHA[piece] : SYMBOL[piece]) || '';
        td.appendChild(span);
      }
      const sq = files[c]+(8-r); td.dataset.sq = sq; td.onclick = ()=> onSquareClick(td);
      // coords
      if(r===7){ const f=document.createElement('div'); f.className='coord-file'; f.textContent=files[c]; td.appendChild(f); }
      if(c===0){ const rk=document.createElement('div'); rk.className='coord-rank'; rk.textContent=(8-r); td.appendChild(rk); }
      tr.appendChild(td);
    }
    table.appendChild(tr);
  }
  container.appendChild(table);
  updateTurnBadge();
}

function updateTurnBadge(){ $('#turnBadge').textContent = (state.turn==='w'?'White':'Black')+' to move'; }

function onSquareClick(td){
  const sq = td.dataset.sq;
  if(!selected){
    const [r,c] = rc(sq); const piece = state.board[r][c];
    if(!piece) return; const isWhite = piece===piece.toUpperCase();
    if((state.turn==='w' && !isWhite) || (state.turn==='b' && isWhite)) return;
    selected = sq; td.classList.add('sel'); statusMsg('Selected '+sq);
    return;
  }
  if(selected===sq){ selected=null; td.classList.remove('sel'); statusMsg('Selection cleared'); return; }
  const ok = tryExpectedMove(selected+sq);
  if(!ok){ flash(td,'bad'); statusMsg('Not the tactic ‚Äî try again','bad'); return; }
  doUci(selected+sq); selected=null; clearSel(); render('board'); stepSolution();
}

function rc(sq){ const file='abcdefgh'.indexOf(sq[0]); const rank=8-parseInt(sq[1],10); return [rank,file]; }
function clearSel(){ $$('.sel').forEach(el=> el.classList.remove('sel')); }
function flash(el, kind='warn'){ const cls= kind==='bad'?'bad':'warn'; el.classList.add(cls); setTimeout(()=> el.classList.remove(cls), 350); }
function statusMsg(t,cls=''){ const s=$('#status'); s.textContent='Status: '+t; s.className=cls; }

/***************
 * Puzzles UCI *
 ***************/
const PUZZLES = [
  {id:'mate_backrank', title:'Mate pattern: back‚Äërank', fen:'6k1/5ppp/8/8/8/8/5PPP/5RK1 w - - 0 1', line:['f1d1','g8f8','d1d8']},
  {id:'ladder_seed', title:'Ladder mate seed', fen:'6k1/5ppp/8/8/8/8/5PPP/6K1 w - - 0 1', line:['g1f1','f8f8','f1e1','f8f8','e1e8']},
  {id:'knight_fork', title:'Knight fork idea', fen:'r1bqk2r/pppp1ppp/2n5/4p3/2B1P3/5N2/PPPP1PPP/RNBQ1RK1 w kq - 2 6', line:['f3g5','d8g5','d1h5']},
  {id:'simple_pin', title:'Pin then win', fen:'rnbqkbnr/pppp1ppp/8/4p3/3P4/8/PPP1PPPP/RNBQKBNR b KQkq - 0 2', line:['d8h4','g2g3','h4d4']},
  {id:'skewer', title:'Skewer motif', fen:'r4rk1/pp3ppp/2n5/2b5/2B5/2N5/PPP2PPP/R2Q1RK1 w - - 0 1', line:['c4f7','c5f2','f7d5']},
  {id:'discovered', title:'Discovered attack', fen:'r1bqk2r/pppp1ppp/2n5/4p3/2B1P3/2N5/PPPP1PPP/R1BQ1RK1 w kq - 2 6', line:['c3b5','a7a6','c4f7']},
  {id:'clearance', title:'Clear a line', fen:'2r2rk1/1p3ppp/p1n1b3/3q4/3P4/2N1PN2/PP3PPP/2RQ1RK1 w - - 0 1', line:['e3e4','d5h5','d1d2']},
  {id:'deflection', title:'Deflect the defender', fen:'r2q1rk1/pp2bppp/2n1pn2/2bp4/2P5/2N1PN2/PP2BPPP/R1BQ1RK1 w - - 0 1', line:['c4d5','e6d5']},
  {id:'decoy', title:'Decoy to fork', fen:'r1bq1rk1/ppp2ppp/2np4/3Np3/2B1P3/5N2/PPP2PPP/R1BQ1RK1 w - - 0 1', line:['c4b5','d6e7']},
  {id:'overload', title:'Overload the defender', fen:'r2q1rk1/ppp2ppp/2np4/3bp3/2B1P3/2N2N2/PPP2PPP/R1BQ1RK1 w - - 0 1', line:['c4d5','d8d7','c1g5']},
  {id:'zwischenzug', title:'Zwischenzug!', fen:'r2q1rk1/pp2bppp/2n1pn2/2bp4/2P5/2N1PN2/PP2BPPP/R1BQ1RK1 w - - 0 1', line:['c4d5','c8g4']},
  {id:'trapped', title:'Trap the bishop', fen:'r1bqkbnr/pppp1ppp/2n5/4p3/1b1P4/5N2/PPPNPPPP/R1BQKB1R w KQkq - 2 4', line:['c2c3','b4d6','d4d5']},
  {id:'xray', title:'X‚Äëray pressure', fen:'r1bq1rk1/ppp2ppp/2np4/3bp3/2B1P3/2N2N2/PPP2PPP/R1BQ1RK1 w - - 0 1', line:['c4d5','d5c4','c1g5']}
];

let current = null; let step = 0;

function loadPuzzle(idx){
  current = PUZZLES[idx]; step = 0; selected=null;
  state = parseFEN(current.fen);
  render('board');
  $('#pzlInfo').innerHTML = `Puzzle: <b>${current.title}</b> ¬∑ <span class="pill">Moves: ${current.line.length}</span>`;
  statusMsg('Your move');
}

function tryExpectedMove(uci){ const expect = current.line[step]; if(!expect) return false; if(uci===expect){ step++; toggleTurn(); return true; } return false; }
function toggleTurn(){ state.turn = (state.turn==='w'?'b':'w'); updateTurnBadge(); }

function stepSolution(){
  if(step < current.line.length && step % 2 === 1){
    const u = current.line[step]; doUci(u); step++; toggleTurn(); render('board'); setTimeout(()=> statusMsg('Your move'), 15);
  }
  if(step >= current.line.length){ statusMsg('Solved!','good'); }
}

function doUci(uci){ const from=uci.slice(0,2), to=uci.slice(2,4); const [r1,c1]=rc(from), [r2,c2]=rc(to); state.board[r2][c2]=state.board[r1][c1]; state.board[r1][c1]=''; }

// Controls
$('#btnHint').onclick = ()=>{ const mv = current.line[step]; if(!mv) return; const to = mv.slice(2,4); $$('.hintSq').forEach(el=> el.classList.remove('hintSq')); const el = document.querySelector(`[data-sq="${to}"]`); if(el){ el.classList.add('hintSq'); setTimeout(()=> el.classList.remove('hintSq'), 1100); } statusMsg('Try to reach '+to, 'warn'); };
$('#btnSolution').onclick = ()=>{ const remain = current.line.slice(step); if(!remain.length) return; const go=i=>{ if(i>=remain.length){ statusMsg('Solution shown','warn'); return; } const u=remain[i]; doUci(u); toggleTurn(); render('board'); setTimeout(()=> go(i+1), 380); }; go(0); step = current.line.length; };
$('#btnRetry').onclick = ()=> loadPuzzle(PUZZLES.indexOf(current));
$('#btnNext').onclick = ()=>{ const i = (PUZZLES.indexOf(current)+1)%PUZZLES.length; loadPuzzle(i); };

// Theme + pieces
$('#selTheme').onchange = ()=>{ const v=$('#selTheme').value; if(v==='high'){ document.body.classList.add('hc'); }else{ document.body.classList.remove('hc'); } render('board'); };
$('#selPieces').onchange = ()=>{ const v=$('#selPieces').value; USE.mode = (v==='alpha')?'alpha':'symbols'; const b=$('#board'); if(v==='alpha'){ b.classList.add('alpha'); } else { b.classList.remove('alpha'); } render('board'); };

// Boot
loadPuzzle(0);
</script>
</body>
</html>
